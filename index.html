<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <script>
    const jsonUrl = 'https://el-dmark.github.io/songbook/lyricsStream_dev.json';

    async function serveSong() {
      const params = new URLSearchParams(window.location.search);
      let songId = params.get("id") || (window.location.hash.substring(1) || 1);

      try {
        const response = await fetch(jsonUrl);
        const songsArray = await response.json();
        const song = songsArray.find(s => s.songID == songId);

        // Clear the page and output only JSON
        document.open();
        document.write(JSON.stringify(song || { error: "Song not found" }));
        document.close();

        // Also set MIME type to JSON (works in most browsers)
        const meta = document.createElement("meta");
        meta.httpEquiv = "Content-Type";
        meta.content = "application/json; charset=UTF-8";
        document.head.appendChild(meta);

      } catch (err) {
        document.open();
        document.write(JSON.stringify({ error: err.message }));
        document.close();
      }
    }

    serveSong();
  </script>
</head>
<body></body>
</html>
